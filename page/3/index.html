<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Window Server IT pro, love scripting.">
<meta property="og:type" content="website">
<meta property="og:title" content="Richie's Personal Blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Richie's Personal Blog">
<meta property="og:description" content="Window Server IT pro, love scripting.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Richie's Personal Blog">
<meta name="twitter:description" content="Window Server IT pro, love scripting.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title> Richie's Personal Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Richie's Personal Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">Life is short, do something meaningful!</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/10/22/基于heartbeat v1 实现基础的httpd高可用集群/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/22/基于heartbeat v1 实现基础的httpd高可用集群/" itemprop="url">
                  基于heartbeat v1 实现基础的httpd高可用集群
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-10-22T14:19:51+08:00">
                2015-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>实验内容：</p>
<p>两台web服务器</p>
<p>node1: 172.31.4.222</p>
<p>node2: 172.31.4.223</p>
<p>vip： 172.31.4.229</p>
<p>实验资源：</p>
<p>1. 高可用的VIP</p>
<p>2. httpd服务</p>
<p>实验目的：</p>
<p>让两台httpd可以实现高可用，通过访问VIP对外提供web服务，一台httpd服务down机，可以自动迁移到另外一台。</p>
<p>实验步骤：</p>
<p>一、资源准备</p>
<p>1. 让node1,node2 可以用ssh无障碍通信</p>
<p>登陆node1:</p>
<h1 id="ssh-root-172-31-4-222"><a href="#ssh-root-172-31-4-222" class="headerlink" title="ssh root@172.31.4.222"></a>ssh <a href="mailto:root@172.31.4.222" target="_blank" rel="external">root@172.31.4.222</a></h1><h1 id="ssh-keygen-–t-rsa-–P-‘’"><a href="#ssh-keygen-–t-rsa-–P-‘’" class="headerlink" title="ssh-keygen –t rsa –P ‘’"></a>ssh-keygen –t rsa –P ‘’</h1><p>编辑/etc/hosts文件，添加两个节点可以通过名称解析，也可以使用dns服务器，但是如果dns服务器损坏将损坏HA集群。这里还是使用/etc/hosts</p>
<p>172.31.4.222 node1.richie.com node1<br>172.31.4.223 node2.richie.com node2  </p>
<p>给node1设置好hostname, 确保名称要和 ‘uname –n’ 获取到的一致才可以，否则heartbeat服务无法启动</p>
<p>将密钥复制给node2</p>
<p>ssh-copy-id –I .ssh/id_rsa.pub <a href="mailto:root@node2" target="_blank" rel="external">root@node2</a></p>
<p>登陆node2, 重复上述步骤实现node2 –&gt; node1之间的ssh无密码互访</p>
<p>至此，node1,node2就可以无密码ssh互访了.</p>
<p>2. 确保node1,node2的时间同步</p>
<p>node1:</p>
<p>ssh node2.richie.com ‘date’;date</p>
<p>如果时间不一致，分别运行ntpdate NTPSERVERIP，保证两个node都指向同一个ntp服务器</p>
<p>设置个crontab定时任务保证时间定期更新</p>
<p>crontab –e</p>
<p><em>/5 </em> <em> </em> * /usr/sbin/ntpdate 172.16.0.1 &amp;&gt; /dev/null</p>
<p>3. heartbeat安装</p>
<p>3.1 解决依赖性</p>
<p>安装heartbeat有些依赖包需要安装，而有些包(libnet)在epel源才有，所以先安装epel源</p>
<p>rpm -ivh <a href="http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-
release-6-8.noarch.rpm" target="_blank" rel="external">http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-
release-6-8.noarch.rpm</a></p>
<p>安装依赖包</p>
<p>yum install perl-TimeDate PyXML libnet net-snmp-libs</p>
<p>安装heartbeat及组件</p>
<p>由于CentOS6 提供的是heartbeat v3，不要使用yum来安装heartbeat，会被系统替换成v3版本的cluster-glue</p>
<p>heartbeat-2.1.4-12.el6.x86_64.rpm<br>heartbeat-debuginfo-2.1.4-12.el6.x86_64.rpm<br>heartbeat-devel-2.1.4-12.el6.x86_64.rpm<br>heartbeat-gui-2.1.4-12.el6.x86_64.rpm<br>heartbeat-ldirectord-2.1.4-12.el6.x86_64.rpm<br>heartbeat-pils-2.1.4-12.el6.x86_64.rpm<br>heartbeat-stonith-2.1.4-12.el6.x86_64.rpm</p>
<p>rpm -ivh heartbeat-pils-2.1.4-12.el6.x86_64.rpm</p>
<p>rpm -ivh heartbeat-2.1.4-12.el6.x86_64.rpm heartbeat-<br>stonith-2.1.4-12.el6.x86_64.rpm</p>
<p>node1上安装好后，把文件传到node2,node3</p>
<p>scp heartbeat-* node2:/root</p>
<p>scp heartbeat-* node3:/root</p>
<p>4. heartbeat v2配置</p>
<p>虽然我们安装的是heartbeat v2版本，但是是和v1兼容的，修改配置文件ha.cf即可</p>
<p>heartbeat v1的配置文件：</p>
<p>/etc/ha.d/ha.cf 主配置文件</p>
<p>/etc/ha.d/authkeys 权限必须为400,600</p>
<p>/etc/ha.d/haresources.cf 配置资源的文件</p>
<p>4.1 ha.cf的配置：</p>
<p>node1:</p>
<p>默认没有提供配置文件，需要去取sample创建</p>
<h1 id="cp-usr-share-doc-heartbeat-2-1-4-ha-cf-haresources-authkeys-etc-ha-d"><a href="#cp-usr-share-doc-heartbeat-2-1-4-ha-cf-haresources-authkeys-etc-ha-d" class="headerlink" title="cp /usr/share/doc/heartbeat-2.1.4/{ha.cf,haresources,authkeys} /etc/ha.d"></a>cp /usr/share/doc/heartbeat-2.1.4/{ha.cf,haresources,authkeys} /etc/ha.d</h1><p>vim ha.cf 主要的几个配置项</p>
<p>logfacility local0 使用rsyslog记录日志</p>
<p>logfile /var/log/ha-log 使用自己维护的日志文件</p>
<p>mcast eth0 225.100.90.101 694 1 0 组播网卡及组播方式，下面是详细介绍</p>
<blockquote>
<h1 id="Set-up-a-multicast-heartbeat-medium"><a href="#Set-up-a-multicast-heartbeat-medium" class="headerlink" title="Set up a multicast heartbeat medium"></a>Set up a multicast heartbeat medium</h1><h1 id="mcast-dev-mcast-group-port-ttl-loop"><a href="#mcast-dev-mcast-group-port-ttl-loop" class="headerlink" title="mcast [dev] [mcast group] [port] [ttl] [loop]"></a>mcast [dev] [mcast group] [port] [ttl] [loop]</h1><h1 id=""><a href="#" class="headerlink" title=" "></a> </h1><h1 id="dev-device-to-send-rcv-heartbeats-on"><a href="#dev-device-to-send-rcv-heartbeats-on" class="headerlink" title="[dev] device to send/rcv heartbeats on"></a>[dev] device to send/rcv heartbeats on</h1><h1 id="mcast-group-multicast-group-to-join-class-D-multicast-address"><a href="#mcast-group-multicast-group-to-join-class-D-multicast-address" class="headerlink" title="[mcast group] multicast group to join (class D multicast address"></a>[mcast group] multicast group to join (class D multicast address</h1><h1 id="224-0-0-0-239-255-255-255"><a href="#224-0-0-0-239-255-255-255" class="headerlink" title="224.0.0.0 - 239.255.255.255)"></a>224.0.0.0 - 239.255.255.255)</h1><h1 id="port-udp-port-to-sendto-rcvfrom-set-this-value-to-the"><a href="#port-udp-port-to-sendto-rcvfrom-set-this-value-to-the" class="headerlink" title="[port] udp port to sendto/rcvfrom (set this value to the"></a>[port] udp port to sendto/rcvfrom (set this value to the</h1><h1 id="same-value-as-“udpport”-above"><a href="#same-value-as-“udpport”-above" class="headerlink" title="same value as “udpport” above)"></a>same value as “udpport” above)</h1><h1 id="ttl-the-ttl-value-for-outbound-heartbeats-this-effects"><a href="#ttl-the-ttl-value-for-outbound-heartbeats-this-effects" class="headerlink" title="[ttl] the ttl value for outbound heartbeats. this effects"></a>[ttl] the ttl value for outbound heartbeats. this effects</h1><h1 id="how-far-the-multicast-packet-will-propagate-0-255"><a href="#how-far-the-multicast-packet-will-propagate-0-255" class="headerlink" title="how far the multicast packet will propagate. (0-255)"></a>how far the multicast packet will propagate. (0-255)</h1><h1 id="Must-be-greater-than-zero"><a href="#Must-be-greater-than-zero" class="headerlink" title="Must be greater than zero."></a>Must be greater than zero.</h1><h1 id="loop-toggles-loopback-for-outbound-multicast-heartbeats"><a href="#loop-toggles-loopback-for-outbound-multicast-heartbeats" class="headerlink" title="[loop] toggles loopback for outbound multicast heartbeats."></a>[loop] toggles loopback for outbound multicast heartbeats.</h1><h1 id="if-enabled-an-outbound-packet-will-be-looped-back-and"><a href="#if-enabled-an-outbound-packet-will-be-looped-back-and" class="headerlink" title="if enabled, an outbound packet will be looped back and"></a>if enabled, an outbound packet will be looped back and</h1><h1 id="received-by-the-interface-it-was-sent-on-0-or-1"><a href="#received-by-the-interface-it-was-sent-on-0-or-1" class="headerlink" title="received by the interface it was sent on. (0 or 1)"></a>received by the interface it was sent on. (0 or 1)</h1><h1 id="Set-this-value-to-zero"><a href="#Set-this-value-to-zero" class="headerlink" title="Set this value to zero."></a>Set this value to zero.</h1></blockquote>
<p>node node1.richie.com 定义两个节点<br>node node2.richie.com</p>
<p>ping 172.31.4.1 指定一个ping节点，一般指向网关</p>
<p>这些信息就够了，:wq保存退出</p>
<p>4.2 配置/etc/ha.d/authkeys</p>
<p>先生成一段随机码：</p>
<p>openssl rand -hex 8</p>
<p>然后复制到/etc/ha.d/authkeys内</p>
<p>auth 2</p>
<p>2 sha1 随机码</p>
<p>:wq保存退出</p>
<p>4.3 配置/etc/ha.d/haresources</p>
<p>定义两条资源，ip和httpd服务</p>
<p>node1.richie.com 172.31.4.229/24/eth0/172.16.255.255 httpd</p>
<p>#确保/etc/init.d下面有httpd同名脚本</p>
<p>配置文件就编辑好了， 传给node2</p>
<p>scp –p ha.cf haresources authkeys node2:/etc/ha.d</p>
<p>准备httpd服务</p>
<p>node1:</p>
<p>yum install httpd –y</p>
<p>创建一个测试页面</p>
<p>vi /var/www/html/index.html</p>
<blockquote>
<h1 id="node1-richie-com"><a href="#node1-richie-com" class="headerlink" title="node1.richie.com"></a>node1.richie.com</h1></blockquote>
<p>一定确保httpd服务不能开机自启</p>
<p>chkconfig httpd off</p>
<p>node2:</p>
<p>node1:</p>
<p>yum install httpd –y</p>
<p>创建一个测试页面</p>
<p>vi /var/www/html/index.html</p>
<blockquote>
<h1 id="node1-richie-com-1"><a href="#node1-richie-com-1" class="headerlink" title="node1.richie.com"></a>node1.richie.com</h1></blockquote>
<p>chkconfig httpd off</p>
<p>5. 启动heartbeat服务</p>
<p>node1:</p>
<p>service heartbeat start</p>
<p>ssh node2 ‘service heartbeat start’</p>
<p>稍等片刻，应该可以看到node1上</p>
<p>eth0:0 Link encap:Ethernet HWaddr 00:0C:29:AE:A7:FB<br>inet addr:172.31.4.229 Bcast:172.16.255.255 Mask:255.255.255.0<br>UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</p>
<p>访问VIP： <a href="http://172.31.4.229" target="_blank" rel="external">http://172.31.4.229</a> ..ok</p>
<p><a href="zb_users/upload/2015/10/56287faccb3cb737493594.png"><img src="zb_users/upload/2015/10/56287fb01da0a607143342.png" alt="image"></a></p>
<p>然后测试，将node1的heartbeat停掉，看是否会自动迁移VIP和httpd服务到node2</p>
<p><a href="zb_users/upload/2015/10/56287fb0adc15724800655.png"><img src="zb_users/upload/2015/10/56287fb3240e0734083851.png" alt="image"></a></p>
<p>ok，试验成功。</p>
<p>除此之外，节点的资源上下线可以使用命令：</p>
<p>/usr/lib64/heartbeat/hb_standby 主动卸载资源</p>
<p>/usr/lib64/heartbeat/hb_takeover 主动抢夺资源</p>
<p>/usr/lib64/heartbeat/ha_propagate 自动实现通告给node2，并自动复制配置文件，不需要在手动scp来复制了</p>
<p>附：</p>
<p>ha.cf配置文件部分参数详解：</p>
<p>autojoin none  </p>
<p>#集群中的节点不会自动加入<br>logfile /var/log/ha-log  </p>
<p>#指名heartbaet的日志存放位置<br>keepalive 2  </p>
<p>#指定心跳使用间隔时间为2秒（即每两秒钟在eth1上发送一次广播）<br>deadtime 30  </p>
<p>#指定备用节点在30秒内没有收到主节点的心跳信号后，则立即接管主节点的服务资源<br>warntime 10  </p>
<p>#指定心跳延迟的时间为十秒。当10秒钟内备份节点不能接收到主节点的心跳信号时，就会往日志中写入一个警告日志，但此时不会切换服务<br>initdead 120  </p>
<p>#在某些系统上，系统启动或重启之后需要经过一段时间网络才能正常工作，该选项用于解决这种情况产生的时间间隔。取值至少为deadtime的两倍。  </p>
<p>udpport 694  </p>
<p>#设置广播通信使用的端口，694为默认使用的端口号。<br>baud 19200  </p>
<p>#设置串行通信的波特率  </p>
<p>#bcast eth0  </p>
<h1 id="Linux-指明心跳使用以太网广播方式，并且是在eth0接口上进行广播。"><a href="#Linux-指明心跳使用以太网广播方式，并且是在eth0接口上进行广播。" class="headerlink" title="Linux 指明心跳使用以太网广播方式，并且是在eth0接口上进行广播。"></a>Linux 指明心跳使用以太网广播方式，并且是在eth0接口上进行广播。</h1><p>#mcast eth0 225.0.0.1 694 1 0  </p>
<p>#采用网卡eth0的Udp多播来组织心跳，一般在备用节点不止一台时使用。Bcast、ucast和mcast分别代表广播、单播和多播，是组织心跳的三种方式，任选其一即可。  </p>
<p>#ucast eth0 192.168.1.2  </p>
<p>#采用网卡eth0的udp单播来组织心跳，后面跟的IP地址应为双机对方的IP地址<br>auto_failback on  </p>
<p>#用来定义当主节点恢复后，是否将服务自动切回，heartbeat的两台主机分别为主节点和备份节点。主节点在正常情况下占用资源并运行所有的服务，遇到故障时把资源交给备份节点并由备份节点运行服务。在该选项设为on的情况下，一旦主节点恢复运行，则自动获取资源并取代备份节点，如果该选项设置为off，那么当主节点恢复后，将变为备份节点，而原来的备份节点成为主节点  </p>
<p>#stonith baytech /etc/ha.d/conf/stonith.baytech  </p>
<h1 id="stonith的主要作用是使出现问题的节点从集群环境中脱离，进而释放集群资源，避免两个节点争用一个资源的情形发生。保证共享数据的安全性和完整性。"><a href="#stonith的主要作用是使出现问题的节点从集群环境中脱离，进而释放集群资源，避免两个节点争用一个资源的情形发生。保证共享数据的安全性和完整性。" class="headerlink" title="stonith的主要作用是使出现问题的节点从集群环境中脱离，进而释放集群资源，避免两个节点争用一个资源的情形发生。保证共享数据的安全性和完整性。"></a>stonith的主要作用是使出现问题的节点从集群环境中脱离，进而释放集群资源，避免两个节点争用一个资源的情形发生。保证共享数据的安全性和完整性。</h1><p>#watchdog /dev/watchdog  </p>
<p>#该选项是可选配置，是通过Heartbeat来监控系统的运行状态。使用该特性，需要在内核中载入”softdog”内核模块，用来生成实际的设备文件，如果系统中没有这个内核模块，就需要指定此模块，重新编译内核。编译完成输入”insmod<br>softdog”加载该模块。然后输入”grep misc /proc/devices”(应为10)，输入”cat /proc/misc |grep<br>watchdog”(应为130)。最后，生成设备文件：”mknod /dev/watchdog c 10 130” 。即可使用此功能<br>node node1.magedu.com  </p>
<p>#主节点主机名，可以通过命令“uname –n”查看。<br>node node2.magedu.com  </p>
<p>#备用节点主机名<br>ping 192.168.12.237  </p>
<p>#选择ping的节点，ping<br>节点选择的越好，HA集群就越强壮，可以选择固定的路由器作为ping节点，但是最好不要选择集群中的成员作为ping节点，ping节点仅仅用来测试网络连接<br>ping_group group1 192.168.12.120 192.168.12.237  </p>
<p>#类似于ping ping一组ip地址<br>apiauth pingd gid=haclient uid=hacluster<br>respawn hacluster /usr/local/ha/lib/heartbeat/pingd -m 100 -d 5s  </p>
<p>#该选项是可选配置，列出与heartbeat一起启动和关闭的进程，该进程一般是和heartbeat集成的插件，这些进程遇到故障可以自动重新启动。最常用的进程是pingd，此进程用于检测和监控网卡状态，需要配合ping语句指定的ping<br>node来检测网络的连通性。其中hacluster表示启动pingd进程的身份。  </p>
<p>#下面的配置是关键，也就是激活crm管理，开始使用v2 style格式  </p>
<h1 id="crm-respawn"><a href="#crm-respawn" class="headerlink" title="crm respawn"></a>crm respawn</h1><p>#注意，还可以使用crm yes的写法，但这样写的话，如果后面的cib.xml配置有问题  </p>
<p>#会导致heartbeat直接重启该服务器，所以，测试时建议使用respawn的写法  </p>
<p>#下面是对传输的数据进行压缩，是可选项<br>compression bz2<br>compression_threshold 2</p>
<p>注意，v2 style不支持ipfail功能，须使用pingd代替</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/09/06/利用PowerShell查看远程计算机磁盘容量/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/06/利用PowerShell查看远程计算机磁盘容量/" itemprop="url">
                  利用PowerShell查看远程计算机磁盘容量
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-09-06T13:02:51+08:00">
                2015-09-06
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>给出一个详细的命令，包含格式化输出。</p>
<p>Get-WmiObject -Class win32<em>logicaldisk -ComputerName computername | select<br>FreeSpace -ExpandProperty freespace | foreach {“{0:n1}” -f ($</em> / 1GB)}</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/07/30/使用powershell远程重启带依赖项服务/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/30/使用powershell远程重启带依赖项服务/" itemprop="url">
                  使用powershell远程重启带依赖项服务
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-07-30T20:31:44+08:00">
                2015-07-30
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>(Get-Service W32Time).Start()</p>
<p>PowerShell V3好像有了管理远程桌面session的命令：</p>
<p>Get-TerminalSession</p>
<p>Disconnect-TerminalSession</p>
<p>获取到远程服务器上的session id， 然后用Disconnect-TerminalSession来关闭就可以了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/07/25/nfs基本应用之httpd+nfs负载均衡实验/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/25/nfs基本应用之httpd+nfs负载均衡实验/" itemprop="url">
                  nfs基本应用之httpd+nfs负载均衡实验
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-07-25T19:32:48+08:00">
                2015-07-25
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本次实验内容是为了练习刚刚学过的httpd及nfs的配置，实现使用nfs文件系统来完成httpd非格式化数据的存储。  </p>
<p>实验环境：</p>
<p>主机A 192.168.1.100 CentOS6.6 httpd服务器</p>
<p>主机B 192.168.1.101 CentOS6.6 httpd服务器</p>
<p>主机C 192.168.1.102 CentOS6.6 MySQL服务器</p>
<p>实验原理：</p>
<p>主机A和B作为前端WEB服务器连接主机C的MySQL数据库，在主机A上创建的博客图片及附件，在主机B上也可以访问：</p>
<p>实验拓扑：</p>
<p><a href="http://s3.51cto.com/wyfs02/M00/70/28/wKiom1Wy9qayFMpkAAGRowvt8Qk135.jpg" target="_blank" rel="external"><img src="http://s3.51cto.com/wyfs02/M00/70/28/wKiom1Wy9qayFMpkAAGRowvt8Qk135.jpg" alt="wKiom1Wy9qayFMpkAAGRowvt8Qk135.jpg"></a></p>
<p>实验分析：</p>
<p>由于主机A、B都使用nfs分区挂载，则博客程序只需要安装一次，配置好nfs权限，主机C上建立nfs服务器及MySQL服务器，提供给主机A、B远程访问权限即可</p>
<p>实验步骤：</p>
<p>一、配置MySQL服务器</p>
<p>MySQL Server(192.168.1.102)：</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>|</p>
<p><code>#yum install sql-server</code></p>
<p><code>#chkconfig mysqld on</code></p>
<p><code>#service mysqld start</code>  </p>
<p>—|—  </p>
<p>创建数据库：</p>
<p>1</p>
<p>2</p>
<p>|</p>
<p><code>#mysql</code></p>
<p><code>#mysql&gt; CREATE DATABASE wordpress;</code>  </p>
<p>—|—  </p>
<p>赋予远程MySQL权限：</p>
<p>给192.168.1.100/101两台httpd服务器远程登陆mysql的权限</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>|</p>
<p><code>#mysql&gt;GRANT ALL ON wordpress.* TO jingming@192.168.1.100 IDENTIFIED BY
&#39;password&#39;;</code></p>
<p><code>#mysql&gt;GRANT ALL ON wordpress.* TO jingming@192.168.1.101 IDENTIFIED BY
&#39;password&#39;;</code></p>
<p><code>#mysql&gt;FLUSH PRIVILEGES;</code></p>
<p><code>#mysql&gt;\q</code>  </p>
<p>—|—  </p>
<p>启动nfs服务：</p>
<p>创建nfs共享目录：</p>
<p>1</p>
<p>|</p>
<p><code>#mkdir /nfs</code>  </p>
<p>—|—  </p>
<p>配置nfs共享权限：</p>
<p>1</p>
<p>|</p>
<p><code>#vim /etc/exports</code>  </p>
<p>—|—  </p>
<p>修改内容：</p>
<p>1</p>
<p>2</p>
<p>|</p>
<p><code>/nfs</code> <code>192.168.1.100(no_root_squash,rw) 192.168.1.101(no_root_squash,rw)</code></p>
<p><code>保存退出 :wq</code>  </p>
<p>—|—  </p>
<p>启动nfs服务：</p>
<p>1</p>
<p>|</p>
<p><code>#service nfs start</code>  </p>
<p>—|—  </p>
<p>查看nfs共享状态：</p>
<p><a href="http://s3.51cto.com/wyfs02/M02/70/2D/wKioL1WzYg7SWMbcAABhMBZhxbc394.jpg" target="_blank" rel="external"></a><a href="http://s3.51cto.com/wyfs02/M00/70/2D
/wKioL1WzYh-jhQWuAABG_nGuQIQ864.jpg" target="_blank" rel="external"><img src="http://s3.51cto.com/wyfs02/M00/70/2D
/wKioL1WzYh-jhQWuAABG_nGuQIQ864.jpg" alt="wKioL1WzYh-jhQWuAABG_nGuQIQ864.jpg"></a></p>
<p>已经可以看到192.168.1.102上nfs的共享了。</p>
<p>二、 主机A(192.168.1.100) 配置</p>
<p>在httpd服务器上挂载nfs分区：</p>
<p>创建挂载点目录</p>
<p>1</p>
<p>|</p>
<p><code>#mkdir /var/www/html/wp</code>  </p>
<p>—|—  </p>
<p>临时生效：</p>
<p>1</p>
<p>|</p>
<p><code>#mount -t nfs 192.168.1.102:/nfs /var/www/html/wp</code>  </p>
<p>—|—  </p>
<p>重启后永久生效：</p>
<p>1</p>
<p>|</p>
<p><code>#vim /etc/fstab</code>  </p>
<p>—|—  </p>
<p>添加一行：</p>
<p>1</p>
<p>|</p>
<p><code>192.168.1.102:``/nfs</code> <code>/var/www/html/wp</code> <code>nfs defualts,_netdev 0 0</code>  </p>
<p>—|—  </p>
<p>保存退出 :wq</p>
<p>安装httpd及php扩展：</p>
<p>1</p>
<p>|</p>
<p><code>#yum install -y httpd php php-mysql</code>  </p>
<p>—|—  </p>
<p>下载安装wordpress博客：</p>
<p>1</p>
<p>2</p>
<p>|</p>
<p><code>#wget https://cn.wordpress.org/wordpress-4.2.2-zh_CN.tar.gz</code></p>
<p><code>#tar xf wordpress-4.2.2-zh_CN.tar.gz -C /var/www/html/wp</code>  </p>
<p>—|—  </p>
<p>保证上传附件有权限：</p>
<p>1</p>
<p>|</p>
<p><code>#chown :apache -R wp-content/</code>  </p>
<p>—|—  </p>
<p>启动httpd服务：</p>
<p>1</p>
<p>2</p>
<p>|</p>
<p><code>#chkconfig httpd on</code></p>
<p><code>#service httpd start</code>  </p>
<p>—|—  </p>
<p>注意： 一定要关掉iptables和selinux，否则不是网页无法显示，就是403权限问题</p>
<p>及时生效：</p>
<p>1</p>
<p>2</p>
<p>|</p>
<p><code>#service iptables stop</code></p>
<p><code>#setenforce 0</code>  </p>
<p>—|—  </p>
<p>永久生效：</p>
<p>1</p>
<p>2</p>
<p>|</p>
<p><code>#chkconfig iptables off</code></p>
<p><code>#vim /etc/selinux/config--&gt; 编辑SELINUX=disabled</code>  </p>
<p>—|—  </p>
<p>三、 主机B(192.168.1.101)配置：</p>
<p>挂载nfs分区：</p>
<p>创建挂载点目录</p>
<p>1</p>
<p>|</p>
<p><code>#mkdir /var/www/html/wp</code>  </p>
<p>—|—  </p>
<p>临时生效：</p>
<p>1</p>
<p>|</p>
<p><code>#mount -t nfs 192.168.1.102:/nfs /var/www/html/wp</code>  </p>
<p>—|—  </p>
<p>重启后永久生效：</p>
<p>1</p>
<p>|</p>
<p><code>#vim /etc/fstab</code>  </p>
<p>—|—  </p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>|</p>
<p><code>添加一行：</code></p>
<p><code>192.168.1.102:``/nfs</code> <code>/var/www/html/wp</code> <code>nfs defualts,_netdev 0 0</code></p>
<p><code>保存退出 :wq</code>  </p>
<p>—|—  </p>
<p>安装httpd及PHP扩展</p>
<p>1</p>
<p>|</p>
<p><code>#yum install -y httpd php php-mysql</code>  </p>
<p>—|—  </p>
<p>启动httpd服务</p>
<p>1</p>
<p>2</p>
<p>|</p>
<p><code>#chkconfig httpd on</code></p>
<p><code>#service httpd start</code>  </p>
<p>—|—  </p>
<p>到此，实验命令部分结束。</p>
<p>从客户端浏览器访问<a href="http://192.168.1.100/wp" target="_blank" rel="external">http://192.168.1.100/wp</a>进行简单的wordpress配置，这里就不详述了。</p>
<p>然后在http:192.168.1.100/wp上创建一个博客文章，并上传一张附件：</p>
<p>如图：</p>
<p><a href="http://s3.51cto.com/wyfs02/M01/70/30/wKiom1WzXiSiynwnAAH0Nhy05Cw804.jpg" target="_blank" rel="external"><img src="http://s3.51cto.com/wyfs02/M01/70/30/wKiom1WzXiSiynwnAAH0Nhy05Cw804.jpg" alt="wKiom1WzXiSiynwnAAH0Nhy05Cw804.jpg"></a></p>
<p>然后在用客户端浏览器访问 <a href="http://192.168.1.101/wp" target="_blank" rel="external">http://192.168.1.101/wp</a></p>
<p>如果你幸运的话，会看到同样的图：</p>
<p><a href="http://s3.51cto.com/wyfs02/M01/70/30/wKiom1WzXtPDZhcAAAKDIdkYX8A663.jpg" target="_blank" rel="external"><img src="http://s3.51cto.com/wyfs02/M01/70/30/wKiom1WzXtPDZhcAAAKDIdkYX8A663.jpg" alt="wKiom1WzXtPDZhcAAAKDIdkYX8A663.jpg"></a></p>
<p>其实这样用IP访问，其实会有些问题。</p>
<p>登陆后台的时候，由于wordpress程序的原因，还是跳到192.168.1.100服务器的管理后台，使用DNS创建一个域名，然后添加两条A记录分别指向这两台服务器就可以达到实验目的了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/07/10/TCP及socket通信原理/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/10/TCP及socket通信原理/" itemprop="url">
                  TCP及socket通信原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-07-10T15:16:08+08:00">
                2015-07-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一、TCP协议：</p>
<p>如图，TCP (Transmission Control Protocol) 传输控制协议，是一种面向连接的、可靠的、基于字节流的传输层协议。</p>
<p>TCP协议完成第四层传输层所指定的功能，TCP层位于IP层之上，应用层之下的中间层。</p>
<p>不同主机的应用层之间经常需要可靠的、像管道一样的连接，但是IP层不提供这样的流机制，只是提供IP报文的不可靠的包交换</p>
<p>应用层向TCP层发送用于网间传输的、用8位字节表示的数据流，然后TCP把数据流分区成适当长度的报文段（通常受该计算机连接的网络的数据链路层的最大传输单元（<br>MTU）的限制）。之后TCP把结果包传给IP层，由它来通过网络将包传送给接收端实体<br>的TCP层。TCP为了保证不发生丢包，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的包发回一个相应的确认（ACK）；如果发送端实体在合理的往返时延（<a href="http://baike.baidu.com/view/262201.htm" target="_blank" rel="external">RTT</a>）内未收到确认，那么对应的数据包就被假设为已丢失将会被进行重传。TCP用一个校验和函数来检验数据是否有错误；在发送和接收时都要计算校验和。</p>
<p>1. TCP 首部</p>
<p><a href="zb_users/upload/2015/07/559f713343110672839274.png"><img src="zb_users/upload/2015/07/559f7133bb67e119646145.png" alt="image"></a></p>
<blockquote>
<p>-–Source Port是源端口，16位。</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>-–Destination Port是目的端口，16位。</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>-–Sequence Number是发送数据包中的第一个字节的序列号，32位。</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>-–Acknowledgment Number是确认序列号，32位。</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>-–Data Offset是数据偏移，4位，该字段的值是TCP首部（包括选项）长度除以4。[1]</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>-–标志位： 6位，URG表示Urgent Pointer字段有意义：</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>ACK表示Acknowledgment Number字段有意义</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>PSH表示Push功能，RST表示复位TCP连接</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>SYN表示SYN报文（在建立TCP连接的时候使用）</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>FIN表示没有数据需要发送了（在关闭TCP连接的时候使用）</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>Window表示接收缓冲区的空闲空间，16位，用来告诉TCP连接对端自己能够接收的最大数据长度。</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>-–Checksum是校验和，16位。</p>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>-–Urgent Pointers是紧急指针，16位，只有URG标志位被设置时该字段才有意义，表示紧急数据相对序列号（Sequence<br>Number字段的值）的偏移。</p>
</blockquote>
<p>2. TCP 连接建立：</p>
<p>TCP是互联网中的传输层协议，使用三次握手建立连接。当主动方发出SYN连接请求后，等待对方回答SYN+ACK，并最终对对方的SYN执行ACK确认。</p>
<p>这种建立方法可以防止产生错误的连接，TCP使用的流量控制协议是可变大小的滑动窗口协议(slice window)</p>
<p><a href="zb_users/upload/2015/07/559f7134d02f2758353257.png"><img src="zb_users/upload/2015/07/559f713569132128183390.png" alt="image"></a></p>
<p>3. TCP 三次握手过程：</p>
<p>1. 客户端发送SYN 报文给服务器端，进入SYN_SEND状态</p>
<p>2. 服务器端收到SYN报文，回应一个SYN-ACK报文，进入SYN_RECV状态</p>
<p>3. 客户端收到服务器端的SYN报文，回应一个ACK报文，进入ESTABLISHED状态</p>
<p>握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP<br>连接都将被一直保持下去。断开连接时服务器和客户端均可以主动发起断开TCP连接的请求，断开过程需要经过 “四次握手”</p>
<p><a href="zb_users/upload/2015/07/559f7135d4bb4183399779.png"><img src="zb_users/upload/2015/07/559f713634309683153391.png" alt="image"></a></p>
<p>4. 四次断开：</p>
<p>建立一个TCP连接需要三次握手，而终止一个TCP连接要经过四次断开，这是由于TCP的半关闭(half-close)造成的。过程如下：</p>
<p>假设Client端发起中断连接请求，也就是发送FIN报文。Server端接到FIN报文后，意思是说”<em>我Client端没有数据要发给你了</em>“，但是如果你还有数据没有发送完成，则不必急着关闭Socket，可以继续发送数据。所以你先发送ACK，”<em>告诉Client端，你的请求我收到了，但是我还没准备好，请继续你等我的消息</em>“。这个时候Client端就进入FIN<em>WAIT状态，继续等待Server端的FIN报文。当Server端确定数据已发送完成，则向Client端发送FIN报文，”</em>告诉Client端，好了，我这边数据发完了，准备好关闭连接了<em>“。Client端收到FIN报文后，”</em>就知道可以关闭连接了，但是他还是不相信网络，怕Server端不知道要关闭，所以发送ACK后进入TIME<em>WAIT状态，如果Server端没有收到ACK则可以重传</em>。“，Server端收到ACK后，”<em>就知道可以断开连接了</em>“。Client端等待了2MSL后依然没有收到回复，则证明<em>Server端已正常关闭，那好，我Client端也可以关闭连接了</em>。Ok，TCP连接就这样关闭了！</p>
<p><img src="http://hi.csdn.net/attachment/201108/7/0_1312719804oSkK.gif" alt=""><br><img src="http://hi.csdn.net/attachment/201108/7/0_1312719833030b.gif" alt=""></p>
<p>在TIME_WAIT状态中，如果TCP client端最后一次发送的ACK丢失了，它将重新发送。TIME_WAIT状态中所需要的时间是依赖于实现方法的。</p>
<p>典型的值为30秒、1分钟和2分钟。等待之后连接正式关闭，并且所有的资源(包括端口号)都被释放。</p>
<p><strong>二、 Socket通信</strong></p>
<p>Socket(套接字): 源IP地址和目的IP地址以及源端口号和目的端口号的组合称为套接字,<br>是支持<a href="http://baike.baidu.com/view/7729.htm" target="_blank" rel="external">TCP/IP</a>的<a href="http://baike.baidu.com/view/538641.htm" target="_blank" rel="external">网络通信</a>的基本操作单元，可以看做是不同主机之间的进程进行双向通信的端点，简单的说就是通信的两方的一种约定，用套接字中的相关函数来完成通信过程。</p>
<p>用户进程通过注册套接字来完成不同主机间的通信(IPC)，socket可以看成两个进程进行通讯连接的一个端点，是连接进程和网络驱动程序的桥梁。</p>
<p>socket在进程中创建，通过绑定与网络驱动建立关系。伺候，应用程序送给socket的数据，由socket交给网络驱动程序向网络中发送出去。</p>
<p>计算机从网络上收到与该socket绑定IP地址和端口号相关的数据后，由网络驱动程序交给socket，进程便可从socket中提取接受到的数据。</p>
<p>众所周知：<br>端口号 0~1023：管理员才有权限使用，永久地分配给某应用使用；<br>注册端口：<br>1024~41951：只有一部分被注册，分配原则上非特别严格；<br>动态端口或私有端口：<br>41952+：</p>
<p>/proc/sys/net/ipv4/ip_local_port_range: 定义两个数字，表示可以做为临时端口的起始数字和结束数字</p>
<p>传输层协议：TCP、UDP、SCTP、DCCP</p>
<p>套接字类型：<br>tcp socket<br>udp socket<br>raw socket：<br>跨过TCP/IP层无法处理的IP包，用socket直接来接受发向本及的ICMP/IGMP协议包，也可以用来发送一些自定义包头或自订协议的IP包。</p>
<p><a href="zb_users/upload/2015/07/559f71369a234254326232.png"><img src="zb_users/upload/2015/07/559f71371d00b482710221.png" alt="image"></a></p>
<p>TCP协议的功能：<br>连接建立<br>将数据打包成段<br>校验和<br>确认、重传以及超时<br>排序<br>序列<br>流量控制<br>缓冲区<br>滑动窗口<br>拥塞控制<br>慢启动<br>拥塞避免算法</p>
<p>RFC：有时间一定好好读读TCP的RFC，会对TCP协议有一个更深层的认识</p>
<p>socket: IPC的一种实现，用于同一或不同主机上的进程间的通信；</p>
<p>socket通信在domain中实现：<br>识别一个socket的方法（socket地址格式），有以下三种类型：</p>
<p>domain:<br>Unix Domain: 基于socket机制实现同一主机不同进程间通信的一种方式；AF_UNIX, AF_LOCAL，地址是一个路径名（文件）<br>IPv4 Domain: AF_INET, 基于socket机制借助于ipv4协议实现不同主机（也可以是同一主机）上的进程间通信的机制；<br>地址是32位的ipv4地址+16位的端口号<br>IPv6 Domain: AF_INET6， 地址是128位的Ipv6地址+16位的端口号</p>
<p>socket的类型：<br>TCP：流式socket，SOCK_STREAM<br>可靠、双向、面向字节流<br>UDP：数据报式socket， SOCK_DGRAM</p>
<p>相关的系统调用：<br>socket(): 创建一个新的socket<br>bind()：绑定于一个套按字地址上；<br>listen(): 监听套接字；<br>accept(): 接收连接请求；</p>
<p>connect(): 发起连接请求；</p>
<p>close(): 关闭连接</p>
<p>read()和write(): recv(), send(), recvfrom(), sendto()</p>
<p><a href="zb_users/upload/2015/07/559f7137a5c41065569126.png"><img src="zb_users/upload/2015/07/559f71383efad805327914.png" alt="image"></a></p>
<p>tcp协议通过tcp状态来标记当前处于通信过程的哪个阶段：<br>CLOSED, LISTEN, SYN_SENT, SYN_RECV, ESTABLISHED, FIN_WAIT1, CLOSE_WAIT,<br>FIN_WAIT2, LAST_ACK, TIME_WAIT, CLOSED</p>
<p>常用软件： 可以查看当前tcp/udp协议的状态: netstat, ss</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/07/10/bind9简单安装配置及高级应用  --赶进度，未完成/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/10/bind9简单安装配置及高级应用  --赶进度，未完成/" itemprop="url">
                  bind9简单安装配置及高级应用  --赶进度，未完成
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-07-10T09:30:13+08:00">
                2015-07-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>简介：  </p>
<p>bind(Berkeley Internet)是由isc.org维护的，</p>
<p>1. bind安装配置</p>
<p>实验拓扑：</p>
<p>master: 192.168.1.100</p>
<p>slave:  192.168.1.200</p>
<p>实验内容：</p>
<p>1. 正向解析 - 在master上配置bind，完成richie.com区域的正向解析</p>
<p>2. 反向解析 - 在master上配置bind，完成168.192.in-addr.arpa区域的反向解析</p>
<p>3. 主从复制 - slave上配置bind，从master上获取richie.com和168.192.in-addr.arpa区域的自动更新</p>
<p>4. bind view - 将www.richie.com记录，根据来源ip网段不同，分配至不同的A记录</p>
<p>#yum install -y bind</p>
<p>bind的配置文档：</p>
<p>服务脚本： /etc/rc.d/init.d/named</p>
<p>主配置文件： /etc/named.conf. /etc/named.rfc1912.zones</p>
<p>区域解析库文件： /var/named/zone_name.zone</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/07/05/CentOS6上DNS服务器的安装配置-基础篇/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/05/CentOS6上DNS服务器的安装配置-基础篇/" itemprop="url">
                  CentOS6上DNS服务器的安装配置-基础篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-07-05T21:44:28+08:00">
                2015-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一、 DNS简介：<br>每个IP地址都可以有一个主机名，主机名由一个或多个字符串组成，字符串之间用小数点隔开。有了主机名，就不要死记硬背每台IP设备的IP地址，只要记住相对直观有意义的主机名就行了。这就是DNS协议所要完成的功能。</p>
<p>二、 DNS查询方式：</p>
<p>DNS共有两种查询方法：</p>
<p>1.递归查询</p>
<p><img src="zb_users/upload/2015/07/201507051436107067384983.jpg" alt="dns-
digui.jpg"></p>
<p>由局部DNS服务器自己负责向其他DNS服务器进行查询，一般是先向该域的根域服务器进行查询，再由根域名服务器一级级向下查询。最后，将得到的查询结果返回结局部DNS服务器，再由局部DNS服务器返回给客户端。</p>
<p>2.迭代查询</p>
<p><img src="zb_users/upload/2015/07/201507051436107075359414.jpg" alt="dns-
recurse.jpg"></p>
<p>当局部DNs服务器自己不能回答客户机的DNs查询请求时，也可以通过迭代查询的方式进行域名解析，如图2所示。局部DNs服务器不是自己向其他DNs服务器进行查询，而是把能解析该域名的其他DNs服务器的IP地址返回给客户端DNS程序，客户端DNs程序再继续向这些DNs服务器发出查询请求，直到得到查询结果为止。</p>
<p>三、常用DNS资源记录类型及示例：</p>
<p>任何解析库文件的第一个记录类型必须是SOA<br>Name [ttl] IN RRType value</p>
<p>1. SOA记录:<br>Start Of Authority<br>Name: 区域名称， 通常可以简写成@<br>[ttl]: time to live, 此值可以省略<br>IN: 是固定的，表示internet<br>RRType： 就是Record Resource Type， 可以使A,AAAA,SOA,NS,CNAME等等<br>value: 主DNS服务器的FQDN,也可以是当前区域的区域名称</p>
<p>例如： @ IN SOA ns.magedu.com. admin.magedu.com. (<br>serial number ;解析库的版本号，例如20150703<br>refresh time ;周期性同步时间间隔<br>retry time ;重试的时间间隔<br>expire time ;过期时长， 从服务器放弃解析的时间间隔<br>nagative answer ttl ; 否定答案的统一缓存时长<br>)</p>
<p>#最后面的. 不能省略,管理员的邮箱地址不能使用@，因为这里@有特殊意义，通常用.来代替<br>记录如果很长，可以使用()来表示 括号内都是一行的内容<br>serial number，需要给定一个起始值，以后每一次更改，就会自动增加，window dns会自动生成，linux需要自己指定  </p>
<p>2. NS记录：<br>name server<br>name: 区域名称<br>value: DNS服务器的FQDN</p>
<p>例如： @ IN NS ns.magedu.com.</p>
<p>注意：<br>如果有多台NS服务器，每一个都必须有对应的NS记录，否则不会被识别成dns服务器，RR有变化，也不会notify<br>对于正向解析来讲，每个NS的FQDN都应该有一个A记录</p>
<p>3. MX记录：<br>Mail eXchanger<br>name: 区域名称<br>value： 邮件服务器的FQDN</p>
<p>例如：<br>@ IN MX 10 mail.magedu.com.<br>@ IN MX 20 mail.magedu.com.</p>
<p>注意：<br>如果有多台MX服务器，每一个都必须有对应的MX记录，单各MX记录还有优先级属性<br>对于正向解析文件来讲，每一个邮件服务器的FQDN都应该有一个A记录</p>
<p>4. A记录:<br>IPv4 Address<br>name: FQDN<br>value: IP</p>
<p>例如：<br>www.magedu.com. IN A 1.1.1.1<br>www.magedu.com. IN A 1.1.1.2</p>
<p>pop3.magedu.com. IN A 1.1.1.3<br>imap.magedu.com. IN A 1.1.1.3</p>
<p>5. AAAA记录:<br>IPv6 Address</p>
<p>6. CNAME记录:<br>Canonical Name<br>name:FQDN<br>value：FQDN</p>
<p>例如：<br>www.magedu.com. IN A 1.1.1.4<br>web.magedu.com. IN CNAME www.magedu.com.</p>
<p>7. PTR记录:<br>pointer 反向解析记录<br>name: 逆向主机IP地址(不包含网络地址)加后缀in-addr.arpa.</p>
<p>例如： 172.16.100.7/16, 网络地址是172.16,主机地址，100.7,其name为7.100.in-addr.arpa.</p>
<p>value: FQDN</p>
<p>例如：<br>7.100.in-addr-arpa. IN PTR www.magedu.com.</p>
<p>常用的DNS资源记录也就这几种，下面来介绍如何在CentOS6下使用bind软件来实现DNS服务器搭建及配置。</p>
<p>四、CentOS6下DNS服务器搭建及简单配置</p>
<p>在Linux系统中，最常用的DNS服务器软件是bind(Bekerley Internet Name<br>Domain),是由isc.org维护更新的，通过rpm -ql bind来查看<br>bind的配置文件及二进制命令。</p>
<p>注意： 这次实验是在内网搭建DNS服务器，并不能对外网提供解析服务，如果需要对外提供DNS服务，还需要到域名注册商去注册域名<br>绑定我们的DNS服务器才能实现对外DNS服务。</p>
<p>1. bind安装</p>
<p>#yum install -y bind.x86_64</p>
<p>2. 修改bind主配置文件 /etc/named.conf</p>
<p>#vim /etc/named.conf, 定义区域：</p>
<p>#此配置文件中，可以用//来标示注释<br>options {<br>//listen-on port 53 { 127.0.0.1; };<br>//listen-on-v6 port 53 { ::1; };<br>directory “/var/named”;<br>dump-file “/var/named/data/cache_dump.db”;<br>statistics-file “/var/named/data/named_stats.txt”;<br>memstatistics-file “/var/named/data/named_mem_stats.txt”;<br>//allow-query { localhost; };<br>recursion yes;</p>
<p>//dnssec-enable yes; //和dnssec相关的内容先不解释，和安全相关<br>//dnssec-validation yes;<br>//dnssec-lookaside auto;</p>
<p>/<em> Path to ISC DLV key </em>/<br>//bindkeys-file “/etc/named.iscdlv.key”;</p>
<p>//managed-keys-directory “/var/named/dynamic”;<br>};</p>
<p>logging {<br>channel default_debug {<br>file “data/named.run”;<br>severity dynamic;<br>};<br>};</p>
<p>zone “.” IN {<br>type hint;<br>file “named.ca”; //13个根节点都在这个文件中<br>};</p>
<p>include “/etc/named.rfc1912.zones”; //定义区域内各种记录的zone配置文件<br>//include “/etc/named.root.key”; //和dnssec相关，先注释掉，下篇博客解释高级应用时候在做详细解释</p>
<p>3. 修改区域定义文件/etc/named.rfc1912.zones</p>
<p>#vim /etc/named.rfc1912.zones<br>在此文件中，bind默认创建了5个zone，分别是：<br>zone “localhost.localdomain”<br>zone “localhost” IN<br>zone<br>“1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa”<br>zone “1.0.0.127.in-addr.arpa”<br>zone “0.in-addr.arpa”<br>本地解释，IPv6的本地解析及其反向本地解析区域，我们保持默认即可，在文件最下方继续追加我们需要创建的区域(zone)<br>追加内容:</p>
<p>zone “mageedu.com” IN {<br>type master;<br>file “mageedu.com.zone”;<br>};</p>
<p>4. 修改区域解析库文件 /etc/named/mageedu.com.zone</p>
<p>$TTL 3600<br>@ IN SOA ns.mageedu.com. admin.mageedu.com. (<br>20150705<br>2H<br>10M<br>7D<br>1D)</p>
<p>IN NS ns.mageedu.com.<br>IN MX 10 mail.mageedu.com.<br>ns.mageedu.com. IN A 172.16.100.7<br>mail.mageedu.com. IN A 172.16.100.8<br>www.mageedu.com. IN A 172.16.100.9<br>pop.mageedu.com. IN CNAME mail.mageedu.com.</p>
<p>5. 修改区域解析库文件的权限及属性</p>
<p>#chgrp named /var/named/mageedu.com.zone  </p>
<p>#chmod 640 /var/named/mageedu.com.zone</p>
<p>6. 检查配置文件的语法</p>
<p>CentOS6下可以使用:  </p>
<p>#service named configtest</p>
<p>由于CentOS7，不在使用Service启动，所以可以使用以下两个命令单独查看：</p>
<p>#named-checkconf 查看主配置文件/etc/named.conf的语法错误  </p>
<p>#named-checkzone 查看区域定义文件/etc/named.rfc1912.zones的语法错误</p>
<p>7. DNS服务器启动  </p>
<p>#service named reload #只要是没有改变监听端口，都可以使用reload命令来重新载入配置信息  </p>
<p>#rndc reload</p>
<p>至此，一个区域为”mageedu.com”的正向解析就创建好了，可以提供解析服务了。<br>但是要注意，需要将客户端的/etc/resolv.conf的DNS服务器地址修改成我们提供DNS服务器的IP</p>
<p>#vim /etc/resolv.conf</p>
<p>五、DNS客户端测试工具</p>
<p>bind-utils包提供了三款DNS客户端测试工具：</p>
<p>#rpm -ql bind-utils</p>
<p>/usr/bin/dig<br>/usr/bin/host<br>/usr/bin/nslookup</p>
<p>接下来，按个介绍下：</p>
<p>a. 正向解析测试：</p>
<p>1). host -t RRType NAME [SERVER]</p>
<p>host -t A www.mageedu.com 使用本机/etc/resolve.conf的name erver来解析<br>host -t A www.mageedu.com 172.16.100.7 使用指定的dns服务器来解析<br>注意： 指定记录，需要特定记录的格式，例如 NS记录，就需要指定一个区域的名字：<br>host -t NS mageedu.com 172.16.100.7</p>
<p>2). nslookup<br>nslookup&gt;<br>server IP:<br>set type={A|SOA|NS|MX…}<br>name： 一定要和type对应的名称</p>
<p>3). dig<br>dig -t TYPE name @server<br>类型可使用: AXFR<br>例如： dig -t AXFR mageedu.com @172.16.100.7</p>
<p>测试反向解析不使用-t PTR,而使用-x选项</p>
<p>dig: 查询选项<br>+trace</p>
<p>+recurese<br>+norecurese</p>
<p>可以用dig -t NS @a.root-servers.net.来生成 name.ca文件，确保获取到的都是最新的根dns</p>
<p>b. 反向区域测试：</p>
<p>区域名称为逆向网络地址加 .in-addr-arpa.<br>例如:<br>zone “100.16.172.in-addr.arpa.” IN {<br>type master;<br>file “172.16.100.zone”;<br>};</p>
<p>反向区域解析库文件： /var/named/172.16.100.zone</p>
<p>$TTL 600 #每一个dns条目的缓存秒数<br>@ IN SOA ns.magedu.com. admin.magedu.com. (<br>20140801 ; 分好后可以写注释<br>2H ;<br>10M<br>7D<br>1D)</p>
<p>IN NS ns.mageedu.com. #这里name没有填写，表示和上一条的name一致</p>
<p>//反向解析无MX记录  </p>
<p>7 IN PTR ns.mageedu.com.<br>8 IN PTR www.mageedu.com.<br>9 IN PTR mail.mageedu.com.</p>
<p>然后可以使用如下几种方法测试反向解析：</p>
<p>#host -t x 172.16.100.9 172.16.100.7  </p>
<p>#dig -t x 172.16.100.7 @172.16.100.7</p>
<p>测试区域  </p>
<p>#dig -t AXFR 100.16.172.in-addr.arpa @172.16.100.7</p>
<p>#172.16.100.in-addr.arpa 是反向区域的名字</p>
<p>说明：<br>1. 正向解析和反向解析文件中的名称可以仅适用于相对名称，他们均相对当前区域而言</p>
<p>@ IN NS ns<br>ns IN A 172.16.100.7<br>mail IN A 172.16.100.8<br>www IN A 172.16.100.9<br>pop IN CNAME mail</p>
<p>或者在zone文件里增加变量$ORIGIN指明简写后的部分<br>例如： $ORIGIN mageedu.com</p>
<p>2. 绝对后缀可以使用$ORIGIN来定义<br>正向<br>$ORIGIN mageedu.com<br>反向<br>$ORIGIN 172.16.100.in-addr-arpa.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/07/02/CentOS6下ssh简介及openssh的应用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/02/CentOS6下ssh简介及openssh的应用/" itemprop="url">
                  CentOS6下ssh简介及openssh的应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-07-02T15:13:27+08:00">
                2015-07-02
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ssh及openssh的应用</p>
<p>1. ssh及openssl简介：</p>
<p>SSH：</p>
<p>ssh是secure shell，是用来通过网络来提供安全的远程访问的工具，C/S结构，在ssh之前，最早的远程计算机连接工具是telnet</p>
<p>telnet是使用明文通信的，所以安全性很差，除非紧急情况，否则不要使用telnet。</p>
<p>ssh则比telnet安全许多，而openssl则是ssh的一种开源实现，</p>
<p>OPENSSH</p>
<p>它可以作为 rlogin、 rsh rcp 以及 telnet 的直接替代品使用。 更进一步， 其他任何 TCP/IP 连接都可以通过 SSH<br>安全地进行隧道/转发。 OpenSSH 对所有的传输进行加密， 从而有效地阻止了窃听、 连接劫持， 以及其他网络级的攻击。OpenSSH 由 OpenBSD<br>project 维护。</p>
<p>登录过程和使用 rlogin 或 telnet 建立的会话非常类似。 在连接时， SSH 会利用一个密钥指纹系统来验证服务器的真实性。 只有在第一次连接时，<br>用户会被要求输入 yes。 之后的连接将会验证预先保存下来的密钥指纹。 如果保存的指纹与登录时接收到的不符， 则将会给出警告。 指纹保存在<br>~/.ssh/known_hosts 中， 对于 SSH v2 指纹， 则是 ~/.ssh/known_hosts2。</p>
<p>默认情况下， 较新版本的 OpenSSH 只接受 SSH v2 连接。 如果能用版本 2 则客户程序会自动使用， 否则它会返回使用版本 1 的模式。 此外，<br>也可以通过命令行参数 -1 或 -2 来相应地强制使用版本 1 或 2。 保持客户端的版本 1 能力是为了考虑较早版本的兼容性。</p>
<p>SSH有两个版本：</p>
<p>1. sshv1</p>
<p>sshv1 基于CRC-32做MAC(完整性校验)，无加密，只是校验码，强烈建议不使用。非常不安全</p>
<p>2. sshv2</p>
<p>sshv2 基于双方主机的协商选择使用最安全的MAC方式</p>
<p>加密机制及MAC机制由双方协商选定：</p>
<p>基于DH算法，实现密钥交换，基于RSA或DSA实现身份认证</p>
<p>客户端通过检查服务器端的主机密钥来判断是否能够继续通信</p>
<p>实际使用中，可以通过命令行参数Protocol 2,1 来相应地强制使用版本 1 或 2。</p>
<p>保持客户端的版本 1 能力是为了考虑较早版本的兼容性。</p>
<p>也可以只写2，而放弃兼容不安全的sshv1</p>
<p>2. OPENSSH客户端：</p>
<p>openssh是C/S架构,所以就有服务端和客户端两部分组成，linux下常用的客户端软件ssh,<br>windows下常用的有putty,xshell,secrecrt,sshshellclient等</p>
<p>2.1 openssh的客户端组件：</p>
<p>2.1.1 ssh 配置文件是/etc/ssh/ssh_config</p>
<p>语法：</p>
<p>ssh [username]@host [COMMAND] [-p PORT]</p>
<p>ssh -l username host [COMMAND]</p>
<p>#若没指定username，则使用本地当前用户尝试登陆，如果远程主机不存在此用户，会报错</p>
<p>#COMMAND，就是不远程登陆，只是在远程主机上执行COMMAND，然后将结果返回给本机。</p>
<p>例如：</p>
<p>需要获取192.168.229.202主机的ifconfig信息，ssh端口监听在2222端口上：</p>
<p>#ssh root@192.168.229.202 ifconfig -p 7767</p>
<p>2.1.2 scp: 利用ssh协议在主机之间实现安全文件传输的工具</p>
<p>语法：</p>
<p>scp SRC1…DEST</p>
<p>分两种情况：</p>
<p>1. 原文件在本机，目标为远程</p>
<p>#scp /path/to/somefile …USERNAME@HOST:/path/to/somewhere</p>
<p>是将本地/path/to/somefile文件，以USERNAME用户登陆到远程主机HOST上，复制到远程主机的/path/to/somewhere</p>
<p>例如：</p>
<p>将本地/etc/fstab文件复制到www.881027.com主机上/tmp下, 注意www.881027.com主机的ssh端口是2222</p>
<p>#scp -P 2222 /etc/fstab root@www.881027.com:/tmp</p>
<p>#注意， 参数-P的位置一定要紧跟在scp命令后面，而且-P指定的是远程主机的ssh端口</p>
<p>#注意， 如果当前本机登陆的用户是root，则root@www.881027.com中的root@可以省略</p>
<p>2. 源文件在远程，本地为目标</p>
<p>#scp USERNAME@HOST:/path/to/somewhere /path/to/somewhere</p>
<p>-r: 复制目录时使用</p>
<p>-p: 保持源文件的元数据信息，包括属主，属组，mode，timestamp (如果远程主机不存在这个用户，也不行)</p>
<p>-q: 静默模式</p>
<p>-P PORT： 指定ssh协议监听的端口</p>
<p>例如：</p>
<p>将远程主机/tmp/fstab文件下载到本机/etc下</p>
<p>#scp -P 2222 root@www.881027.com /etc</p>
<p>2.1.3 sftp: 基于ssh的ftp服务</p>
<p>sftp登陆进去，可以使用很多bash的命令，例如ls,cd, mkdir, put, get等ftp命令</p>
<p>用法： sftp USERNAME@HOST</p>
<p>例如：</p>
<p>sftp登陆到www.881027.com,ssh端口2222，并下载www.881027.com主机上/etc/fstab文件到本地</p>
<p>#sftp -oPort=2222 sbi.881027.com</p>
<p>#-oPort 来指定远程的端口，不指定默认22</p>
<p>3. openssh的服务器端： sshd</p>
<p>配置文件： /etc/ssh/sshd_config</p>
<p>ssh端口，控制sshd服务的各种运行参数等，下面最佳实践里有很多应用</p>
<p>这个命令可以通过</p>
<p>#man sshd_config</p>
<p>来查看每一个参数的详细说明和使用帮助</p>
<p>服务脚本： /etc/rc.d/init.d/sshd</p>
<p>控制sshd服务状态，启动，停止，重启，查看状态等</p>
<p>脚本配置文件： /etc/sysconfig/sshd</p>
<p>3.1 经常需要修改的参数：</p>
<p>PORT： 修改默认监听的端口</p>
<p>ListenAddress 0.0.0.0 默认表示监听本地所有地址，也可以设定只监听特定ip地址</p>
<p>Protocol 2,1  优先选择2，向下兼容sshv1</p>
<p>HostKey /etc/ssh/ssh_host_rsa_key 当客户端连接时候，发送的密钥</p>
<p>HostKey /etc/ssh/ssh_host_dsa_key 当客户端连接时候，发送的密钥， DSA只能做身份验证</p>
<p>KeyRegenerationInterval 1h 密钥交换间隔，服务器自动进行的</p>
<p>LoginGraceTime 2m 登陆窗口宽限期， 就是弹出登陆窗口后，给你输入账号密码的时间</p>
<p>PermitRootLogin yes</p>
<p>yes：允许root用户首次直接ssh登录</p>
<p>no: 不允许root用户首次直接ssh登陆，但是根据需要，可以从普通用户su - root</p>
<p>MaxAuthTries 6 最多登陆失败次数</p>
<p>MaxSessions 10 最多可支持的session数</p>
<p>RSAAuthentication yes 是否启用RSA验证</p>
<p>PubkeyAuthentication yes 是否启用公钥验证(非对称加密)</p>
<p>AuthorizedKeysFile .ssh/authorized_keys 授权的密钥文件，<br>我们可以通过追加公钥信息到这个authorized_keys，来免密码登陆</p>
<p>ClientAliveInterval 0  服务器端向客户端请求消息的时间间隔，0 为不发送</p>
<p>ClientAliveCountMax 300 服务器发出请求后客户端没有响应的次数达到一定值</p>
<p>等等</p>
<p>我只列举一些常用的选项，还有很多选项没有一一列举，可以#man sshd_config去翻文档吧。</p>
<p>4. sshd认证方式:</p>
<p>1. 基于口令的认证：</p>
<p>没啥好说的， 用户名，密码认证</p>
<p>2. 基于密钥(公钥中的密钥)的认证：</p>
<p>逻辑：</p>
<p>a. 需要一对儿密钥，本地保留private key,</p>
<p>b. 将public key放到远程主机上的用户家目录: ~/.ssh/</p>
<p>c. 将本地public key追加到 远程主机家目录 ~/.ssh/authorized_users</p>
<p>步骤：</p>
<p>#ssh-keygen -t rsa 生成密钥对</p>
<p>默认密钥为id_rsa, id_rsa.pub</p>
<p>-f path/to/somefile: 密钥文件保存位置</p>
<p>-p ‘’ 指定oldpasswd</p>
<p>也可以使用工具直接生成密钥对儿，直接上传到远程主机：</p>
<p>#ssh-copy-id -i ~/.ssh/id_rsa.pub USERNAME@HOST</p>
<p>ssh-copy-id -i id_rsa.pub “-p 7767 root@sbi.881027.com”</p>
<p>ssh -p 222 hostname</p>
<p>5. ssh服务的最佳实践：</p>
<p>1. 不要使用默认端口22</p>
<p>2. 不要使用protocol 1</p>
<p>3. 限制可登陆的用户</p>
<p>白名单：</p>
<p>AllowUsers user1 user2 user3…</p>
<p>AllowGroups grp1 grp2 ….</p>
<p>黑名单：</p>
<p>DenyUsers user1 user2</p>
<p>DenyGroups grp1 grp2</p>
<p>#黑白名单不能同时使用，只能使用一种</p>
<p>4. 设定空闲会话超时时长</p>
<p>ClientAliveInterval 300 #秒数</p>
<p>ClientAliveCountMAX 0 #空闲计数最大值为0</p>
<p>5. 利用防火墙设置ssh访问策略：</p>
<p>6. 仅监听在特定的IP地址上，而非本机所有的IP地址</p>
<p>7. 使用强密码策略</p>
<p>#tr -dc A-Za-z0-9 &lt; /dev/urandom | head -c 20 | xargs</p>
<p>8. 使用基于密钥的认证</p>
<p>9， 禁止使用空密码</p>
<p>10. 禁止管理员直接登录</p>
<p>11. 显示ssh的访问频度</p>
<p>iptables可以做到</p>
<p>12. 做好日志，经常分析</p>
<p>把服务器按照最佳实践来优化一番，在去对比下 lastb的ssh攻击，就会看到明显的效果。等以后学到iptables，在做更进一步的优化吧。</p>
<p>另外，提一个小软件 dropbear，是嵌入式轻量级的shh客户端工具，可以编译安装试试。比openssh小很多，但是功能却很完整的ssh开源工具。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/06/30/PowerShell脚本保留目录结构删除文件实例/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/06/30/PowerShell脚本保留目录结构删除文件实例/" itemprop="url">
                  PowerShell脚本保留目录结构删除文件实例
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-06-30T14:25:55+08:00">
                2015-06-30
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近公司一台SQL Server上日志经常填满E盘，所以研究了下需要每周定期删除日志文件。</p>
<p>脚本知识点包括： 如果在powershell内调用.net对象math函数，foreach,日期格式化等等。</p>
<p>这些都是容易忘记的基本技能，大家多多练习吧</p>
<p>脚本内容如下：</p>
<pre><code> Param(
    [Cmdletbinding()]
    $Path = &quot;E:\Logs&quot;
    )
Function delete-LTMlog()
{
    $totalsize=0
    $logcount=0
    $items = gci $path | ?{$_.LastWriteTime -le (get-date).AddDays(-2)}
    $items=$items | ?{$_.PSIscontainer -eq $false} # ignore direcotry item
    foreach($item in $items)
    {
        Write-Verbose &quot;Processing $item&quot;
        $size=gci $path\$item | select Length -ExpandProperty Length
        $totalsize+=$size
        $logcount++
      try{
            Remove-Item $path\$item  #need to catch exceptions
        }
        catch [System.Exception]
        {
            Write-Output &quot;Error occurs in deleting $path\$item&quot; | Out-File D:\xxx
        }


    }
    $date=get-date -Format g
    $totalsize=[math]::truncate($totalsize / 1MB)
    Write-Output &quot; $date Total $logcount logfiles removed $totalsize MB space released.&quot; | Out-File D:\xxx


}
delete-LTMlog
</code></pre><p>希望给大家提供个思路，有疑问可以问我</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/06/25/Linux上基于网络自动化安装系统(CentOS6.5+TFTP+PXE)/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Richie Jing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Richie's Personal Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Richie's Personal Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/06/25/Linux上基于网络自动化安装系统(CentOS6.5+TFTP+PXE)/" itemprop="url">
                  Linux上基于网络自动化安装系统(CentOS6.5+TFTP+PXE)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-06-25T16:52:32+08:00">
                2015-06-25
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Linux上基于网络自动化安装系统(CentOS6.5+DHCP+TFTP+PXE)</p>
<p>一、前言</p>
<p>安装系统常用的方式就是，光驱安装，U盘安装，但是这种手动安装方法效率都很低，而且出错概率大。<br>现在网卡速率也都基本1000M，所以网络安装就显得更简单，把管理员从重复、繁琐的安装操作中解放出来。<br>当然，这只是一个局域网内的实验配置，生产环境会有更专业的解决方案，但是这个原理都是一样的。</p>
<p>二、原理</p>
<p>本次实验用到的协议和技术有：<br>DHCP: Dynamic Host Configuration Protocol 动态主机配置协议<br>TFTP: Trivial File Transfer Protocol 小文件传输协议<br>PXE： Preboot Execution Environment远程引导技术</p>
<p>上图告诉我们本次网络安装中DHCP,TFTP,PXE的关系和启动的过程，本次实验DHCP和TFTP是在同一台服务器。<br>详细流程如下：</p>
<p>如图：</p>
<p><a href="zb_users/upload/2015/06/558bc14c8da7e335558581.png"><img src="zb_users/upload/2015/06/558bc14d097e3113747543.png" alt="image"></a></p>
<p>1. Target client向DHCP服务器发送DHCP请求<br>首先，client端的网卡一定要支持PXE，并且将client的BIOS设置成网络启动为第一顺序，然后PXE<br>BootROM会以UDP协议发送一个广播请求DISCOVER，向网络中的DHCP服务器索取IP地址等信息。</p>
<p>2. DHCP收到广播，并发送广播包回应Client一个OFFER，意义为我可以给你提供ip信息</p>
<p>3. Client收到DHCP的OFFER后，继续发送广播包，向DHCP服务发起REQUEST</p>
<p>4. DHCP服务器收到REQUEST后，验证是否来自合法的PXE<br>Client请求，通过验证后，会响应给client提供：IP地址，pxelinux启动程序位置(TFTP)，以及配置文件所在位置</p>
<p>5. Client向TFTP服务器请求下载启动文件，文件包括：<br>pxelinux.0, vmlinuz, initrd.img, pxelinux.cfg/default, pxelinux.cfg/list</p>
<p>6. TFTP服务器收到请求后，启动TFTP并开始传送启动文件<br>当服务器收到客户端的请求后，他们之间之后将有更多的信息在客户端与服务器之间作应答, 用以决定启动参数。BootROM 由 TFTP 通讯协议从Boot<br>Server下载启动安装程序所必须的文件（pxelinux.0、pxelinux.cfg/default）。default文件下载完成后，系统会下载并读取pxelinux.cfg/list文件，操作人员需要安装list中列出的系统进行选择，启动对应选择的Linux系统并安装程序的引导内核。</p>
<p>三、实验思路</p>
<p>1. 前提条件：<br>Client机器必须支持PXE启动<br>Client机器，DHCP，TFTP必须在同一个局域网内<br>要安装的系统需要有对pxeboot的支持</p>
<p>2. 方案数据：  </p>
<p>预安装系统：<br>CentOS6.6</p>
<p>DHCP服务器(TFTP服务器)信息：<br>IP：192.168.100.200<br>OS： CentOS6.6</p>
<p>Client机器信息：<br>MAC: 00:0c:29:c1:3a:ab<br>ip: 192.168.100.222 (可以在DHCP配置中预留)</p>
<p>四、实验具体操作步骤</p>
<p>1. DHCP服务的配置  </p>
<p>1) 安装dhco服务器包：  </p>
<p>#yum -y install dhcp</p>
<p>2) 编辑dhcp配置文件：<br>a. 可以通过rpm -ql dhcp来查看配置文件的sample，这样编辑起来更容易些：  </p>
<p>#rpm -ql dhcp<br>查到样例在这里 /usr/share/doc/dhcp-4.1.1/dhcpd.conf.sample  </p>
<p>#复制dhcpd.confg.sample到/etc/dhcp/dhcpd.conf  </p>
<p>#cp /usr/share/doc/dhcp-4.1.1/dhcpd.conf<br>b. 编辑dhcpd.conf</p>
<p>vim /etc/dhcp/dhcpd.conf</p>
<p>option domain-name “richie.com”;<br>option domain-name-servers 8.8.8.8;</p>
<p>default-lease-time 86400;<br>max-lease-time 100000;</p>
<p>log-facility local7;<br>subnet 192.168.100.0 netmask 255.255.255.0 {<br>range 192.168.100.201 192.168.100.222;  </p>
<p>#option routers 192.168.100.200;<br>next-server 192.168.100.200; # TFTP服务器的IP（这里就是本机的IP）<br>filename “pxelinux.0”;<br>}</p>
<p>重点注意 next-server 和 filename参数，这里分别指定了TFTP服务器的位置和启动文件的名称</p>
<p>c. 启动DHCP服务<br>启动之前，应该检测下配置文件是否有错误，可以用以下命令：  </p>
<p>#service dhcpd configtest<br>如果提示#Syntax: OK 那就没问题，继续启动DHCP服务</p>
<p>#service dhcpd restart<br>2. TFTP服务器配置<br>1) 安装tftp服务包  </p>
<p>#yum -y install tftp-server  </p>
<p>#TFTP的配置文件位于 /etc/xinetd.d/tftp</p>
<p>2）启动tftp服务<br>由于tftp是瞬时守护进程，依赖于xinetd来监听，所以启动tftp，必须要重启xinetd来是让配置生效</p>
<p>#启动tftp两种方式：<br>a. 修改tftp配置文件中disable=no  </p>
<p>#vim /etc/xinetd.d/tftp  </p>
<p>#disable=no</p>
<p>b. 用chkconfig命令  </p>
<p>#chkconfig tftp on</p>
<p>注意，两种方式任选其一都可以实现，但是必须要重启xinetd，命令如下：</p>
<p>#service xinetd restart<br>查看udp 69端口是否监听  </p>
<h1 id="ss-unl-grep-69"><a href="#ss-unl-grep-69" class="headerlink" title="ss -unl | grep :69"></a>ss -unl | grep :69</h1><p>3) 准备启动文件<br>a. 启动镜像文件pxelinux.0的准备<br>获取这个文件，需要安装syslinux包，然后将pxelinux.0复制到/var/lib/tftpboot目录  </p>
<p>#yum -y install syslinux  </p>
<p>#cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot</p>
<p>b. 提供引导内核等文件<br>同时在/var/lib/tftpboot目录下创建pxelinux.cfg目录<br>挂载系统光盘，假设位置为/media/cdrom/</p>
<h1 id="cp-media-cdrom-images-pxeboot-vmlinuz-initrd-img-var-lib-tftpboot"><a href="#cp-media-cdrom-images-pxeboot-vmlinuz-initrd-img-var-lib-tftpboot" class="headerlink" title="cp /media/cdrom/images/pxeboot/{vmlinuz,initrd.img} /var/lib/tftpboot/"></a>cp /media/cdrom/images/pxeboot/{vmlinuz,initrd.img} /var/lib/tftpboot/</h1><h1 id="cp-media-cdrom-isolinux-splash-jpg-vesamenu-c32-boot-msg"><a href="#cp-media-cdrom-isolinux-splash-jpg-vesamenu-c32-boot-msg" class="headerlink" title="cp /media/cdrom/isolinux/{splash.jpg,vesamenu.c32,boot.msg}"></a>cp /media/cdrom/isolinux/{splash.jpg,vesamenu.c32,boot.msg}</h1><p>/var/lib/tftpboot</p>
<h1 id="mkdir-var-lib-tftpboot-pxelinux-cfg"><a href="#mkdir-var-lib-tftpboot-pxelinux-cfg" class="headerlink" title="mkdir /var/lib/tftpboot/pxelinux.cfg/"></a>mkdir /var/lib/tftpboot/pxelinux.cfg/</h1><h1 id="cp-media-cdrom-isolinux-isolinux-cfg-var-lib-tftpboot-pxelinux-cfg-default"><a href="#cp-media-cdrom-isolinux-isolinux-cfg-var-lib-tftpboot-pxelinux-cfg-default" class="headerlink" title="cp /media/cdrom/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default"></a>cp /media/cdrom/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</h1><p>3. 提供安装源<br>这里我们基于http来提供，挂载CentOS安装光盘镜像<br>a. 安装http服务  </p>
<h1 id="yum-y-install-httpd"><a href="#yum-y-install-httpd" class="headerlink" title="yum -y install httpd"></a>yum -y install httpd</h1><h1 id="mkdir-pv-var-www-html-centos-6-x84-64-用-6-x86-64这种结构，以后便于用变量来引用这个地址"><a href="#mkdir-pv-var-www-html-centos-6-x84-64-用-6-x86-64这种结构，以后便于用变量来引用这个地址" class="headerlink" title="mkdir -pv /var/www/html/centos/6/x84_64 #用/6/x86_64这种结构，以后便于用变量来引用这个地址"></a>mkdir -pv /var/www/html/centos/6/x84_64 #用/6/x86_64这种结构，以后便于用变量来引用这个地址</h1><h1 id="mount-–bind-media-cdrom-var-www-html-centos-6-x84-64-–bind可以绑定两个挂载地址"><a href="#mount-–bind-media-cdrom-var-www-html-centos-6-x84-64-–bind可以绑定两个挂载地址" class="headerlink" title="mount –bind /media/cdrom /var/www/html/centos/6/x84_64 #–bind可以绑定两个挂载地址"></a>mount –bind /media/cdrom /var/www/html/centos/6/x84_64 #–bind可以绑定两个挂载地址</h1><p>然后我们就可以用 在ks.cfg指定安装源为 <a href="http://192.168.100.200/centos/6/x86_64" target="_blank" rel="external">http://192.168.100.200/centos/6/x86_64</a></p>
<p>4. 提供ks.cfg</p>
<p>这里不详细提供如何配置ks.cfg， 这个是kickstart的脚本。可以使用system-config-kickstart工具来创建</p>
<p>ok，基本ok，附图来欣赏下，启动成功的样子吧~~</p>
<p>这个tftp的信息会一闪而过，大家就当是了解下过程吧</p>
<p><a href="zb_users/upload/2015/06/558bc14d51bff254534422.png"><img src="zb_users/upload/2015/06/558bc14db7bbd146157674.png" alt="image"></a></p>
<p><a href="zb_users/upload/2015/06/558bc14eb9fe6495679188.png"><img src="zb_users/upload/2015/06/558bc14fee4cc317774618.png" alt="image"></a></p>
<p>在这个menu状态，按ESC可以进入boot命令行，可以继续键入boot<br>option来指定ks脚本啊，配置ip信息等好多内容，具体的option可以参考redhat的installation guide文档很详细的。</p>
<p><a href="zb_users/upload/2015/06/558bc15023cf6543610518.png"><img src="zb_users/upload/2015/06/558bc1505bec2093137219.png" alt="image"></a></p>
<p>本次实验就到这里， 谢谢大家的关注！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Richie Jing" />
          <p class="site-author-name" itemprop="name">Richie Jing</p>
          <p class="site-description motion-element" itemprop="description">Window Server IT pro, love scripting.</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">82</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Richie Jing</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  




  
  

  

  

  

  


</body>
</html>
